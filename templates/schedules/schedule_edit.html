{% extends 'base/base.html' %}
{% load static %}
{% block title %}Edit Schedule{% endblock %}

{% block content %}
<h2>Edit Schedule</h2>
<form method="post" enctype="multipart/form-data">
    {% csrf_token %}
    {{ form.as_p }}

    <h4>Tasks</h4>
    <div id="formset-container">
        {% for form in formset.forms %}
            <div class="card p-3 mb-2 task-card">
                {{ form.as_p }}
            </div>
        {% endfor %}
    </div>

    {{ formset.management_form }}

    <template id="empty-form">
        <div class="card p-3 mb-2 task-card">
            {{ formset.empty_form.as_p|safe }}
        </div>
    </template>

    <button type="button" class="btn btn-outline-primary mb-3" id="add-task-btn">Add Task</button>
    <br>
    <button type="submit" class="btn btn-success">Save Changes</button>
</form>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function () {
    const totalFormsInput = document.getElementById('id_form-TOTAL_FORMS');
    if (!totalFormsInput) {
        console.error('Management form not found!');
        return;
    }

    let formIdx = parseInt(totalFormsInput.value);

    document.getElementById('add-task-btn').addEventListener('click', function () {
        const emptyFormHtml = document.getElementById('empty-form').innerHTML.replace(/__prefix__/g, formIdx);
        document.getElementById('formset-container').insertAdjacentHTML('beforeend', emptyFormHtml);
        formIdx++;
        totalFormsInput.value = formIdx;
    });
});
</script>
{% endblock %}
